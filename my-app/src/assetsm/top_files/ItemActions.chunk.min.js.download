(("undefined"!=typeof self?self:this).webpackJsonp_pro_gallery_santa_wrapper=("undefined"!=typeof self?self:this).webpackJsonp_pro_gallery_santa_wrapper||[]).push([[2],{111:function(e,t,o){"use strict";o.r(t),o.d(t,"itemActions",(function(){return u}));var r=o(0),n=o(7),i=o.n(n),s=o(8),a=o(15),c=o(81),l=o(4),p=o(36),h=function(){function e(){this.getLoveCount=this.getLoveCount.bind(this),this.wasInit=!1,this.loveCounts={},this.fetchSiteInfo()}return e.prototype.initWidgetData=function(e){if(this.config=e,e.instance&&(this.instance=e.instance),e.items&&(this.items=e.items),e.visitorId&&(this.visitorId=e.visitorId),e.appDefinitionId&&(this.appDefinitionId=e.appDefinitionId),e.sentryReport&&(this.sentryReport=e.sentryReport),e.reportMigratedLoveDataBiEvent&&(this.reportMigratedLoveDataBiEvent=e.reportMigratedLoveDataBiEvent),e.compId&&(this.compId=e.compId),e.pageId&&(this.pageId=e.pageId),e.styleId&&(this.styleId=e.styleId),e.pageUrl&&(this.pageUrl=e.pageUrl),"boolean"==typeof e.isStoreGallery&&(this.isStoreGallery=e.isStoreGallery),"boolean"==typeof e.shouldUseGalleryIdForShareUrl&&(this.shouldUseGalleryIdForShareUrl=e.shouldUseGalleryIdForShareUrl),e.galleryId&&(this.galleryId=e.galleryId),e.viewMode&&(this.viewMode=e.viewMode.toLowerCase()),e.fullscreenUrl){this.siteUrl=this.fullscreenUrl=this.normalizeFullscreenUrl(e.fullscreenUrl);try{this.siteUrl=this.fullscreenUrl.match(/.*\..*\//g)[0]}catch(e){}}return e.onLoveCountsFetched&&(this.onLoveCountsFetched=e.onLoveCountsFetched),this.baseUrl=e.baseUrl||"//progallery.wixapps.net",e.reachLevel&&this.setReachLevel(e.reachLevel),!s.a.isSSR()&&"site"===this.viewMode&&this.galleryId&&""!==this.galleryId&&this.getStats(),this.wasInit=e,Date.now()},e.prototype.setItemsLoveData=function(e){var t=e.itemsLoveData;if(t){this.reactionsServiceResponse=t;var o=void 0;o=p.b.shouldUseNewParsing()?p.b.newParseReactionServiceResponse(t):p.b.parseReactionServiceResponse(t),this.onLoveCountsFetched(o)}},e.prototype.normalizeFullscreenUrl=function(e){var t=e;return e&&(t=e.split("?")[0]),t},e.prototype.fetchSiteInfo=function(){var e,t=this;try{e=l.a.location.href}catch(t){e=""}s.a.isInWix()?(this.siteInfo={},a.a.getSiteInfo((function(e){t.siteInfo=e}))):this.siteInfo={url:e,baseUrl:e,siteTitle:"Wix Pro Gallery",siteDescription:"The best gallery any Wix user has ever seen!",siteKeywords:"gallery,photos,photographer,professional"}},e.prototype.getSiteUrl=function(){return this.siteInfo.url},e.prototype.getStats=function(){return Object(r.b)(this,void 0,void 0,(function(){var e=this;return Object(r.d)(this,(function(t){switch(t.label){case 0:return"site"!==this.viewMode||s.a.isDev()||s.a.isTest()?[2]:!this.galleryId||""===this.galleryId||this.galleryId.length<10?(console.log("galleryId id",this.galleryId,typeof this.galleryId),console.error("get stats error - no galleryId"),[2]):(fetch("".concat(this.baseUrl,"/_api/pro-gallery-webapp/v1/gallery/").concat(this.galleryId,"/stats/properties")).then((function(e){return e.json()})).then((function(t){try{t.properties?e.statsProps=JSON.parse(t.properties):t.statsToken&&(e.statsProps={instance_id:e.config.instanceId,set_id:e.galleryId}),e.statsToken=t.statsToken}catch(e){console.error("Failed getting stats props",e)}})),[4,this.migrateLoveDataFromStatsToReactionService()]);case 1:return t.sent(),p.b.shouldUseReactionService()||this.getLoveDataWithOriginalFunction(),[2]}}))}))},e.prototype.migrateLoveDataFromStatsToReactionService=function(){return Object(r.b)(this,void 0,void 0,(function(){var e,t,o,n,i,a,c,l,h,u,d,v;return Object(r.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,7,,8]),[4,p.b.getItemsLoveData(this.items,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId)];case 1:return(e=r.sent()).hasOwnProperty("error")?("function"==typeof this.sentryReport&&(v=e.error,this.sentryReport(v)),[2]):[4,this.getLoveDataUsingStatsApi()];case 2:return t=r.sent(),p.b.sampleMigrationSuccessRate(e,t,this.sentryReport),0!==Object.keys(e).length?[3,6]:[4,this.getLoveDataUsingStatsApi()];case 3:if(o=r.sent(),!(Object.keys(o).length>0))return[3,6];for("function"==typeof this.reportMigratedLoveDataBiEvent&&this.reportMigratedLoveDataBiEvent({galleryId:this.galleryId,migrationStatus:"start"}),n=[],i=0,a=Object.entries(o);i<a.length;i++)c=a[i],l=c[0],h=c[1],n.push(p.b.mergeDataFromStatsToReactionService(l,h,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId));return[4,Promise.all(n)];case 4:return u=r.sent(),[4,p.b.getItemsLoveData(this.items,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId)];case 5:e=r.sent(),s.a.isSubset(o,e)?"function"==typeof this.reportMigratedLoveDataBiEvent&&this.reportMigratedLoveDataBiEvent({galleryId:this.galleryId,migrationStatus:"success"}):"function"==typeof this.sentryReport&&((d=u.findIndex((function(e){return"200"!==e.status.toString()})))>-1?(v="Reaction-Service error - migrating data failed - ".concat(u[d].status," : ").concat(u[d].message),this.sentryReport(v)):(v="Reaction-Service error - loveCountsReactionService !== loveCountsStatsApi",this.sentryReport(v))),r.label=6;case 6:return[3,8];case 7:return r.sent(),"function"==typeof this.sentryReport&&(v="Reaction-Service error - Migration general error",this.sentryReport(v)),[3,8];case 8:return[2]}}))}))},e.prototype.getLoveDataUsingStatsApi=function(){return Object(r.b)(this,void 0,void 0,(function(){var e,t,o;return Object(r.d)(this,(function(r){switch(r.label){case 0:e="",r.label=1;case 1:return r.trys.push([1,6,,7]),(e=this.config.instanceId||l.a.instanceId)?[3,2]:(console.warn("cannot report love counter - no instance id"),[2]);case 2:return[4,fetch("".concat(this.baseUrl,"/_api/pro-gallery-webapp/v1/gallery/").concat(this.galleryId,"/").concat(e,"/stats"))];case 3:return[4,(t=r.sent()).json()];case 4:return(t=r.sent())&&t.photoId2Love?[2,t.photoId2Love]:[2];case 5:return[3,7];case 6:return o=r.sent(),console.error("Failed getting love counts",o),[3,7];case 7:return[2]}}))}))},e.prototype.getLoveDataWithOriginalFunction=function(){var e,t=this;try{e=this.config.instanceId||l.a.instanceId}catch(t){e=""}e?fetch("".concat(this.baseUrl,"/_api/pro-gallery-webapp/v1/gallery/").concat(this.galleryId,"/").concat(e,"/stats")).then((function(e){return e.json()})).then((function(e){try{e&&e.photoId2Love&&(t.loveCounts=e.photoId2Love,t.onLoveCountsFetched&&t.onLoveCountsFetched(t.loveCounts))}catch(e){console.error("Failed getting love counts",e)}})):console.warn("cannot report love counter - no instance id")},e.prototype.getLoveCount=function(e){return Math.max(0,this.loveCounts[e])||0},e.prototype.html2img=function(e,t){o.e(10).then(o.t.bind(null,251,7)).then((function(o){try{var r=l.a.document.createElement("div");r.innerHTML=e.html,r.style.boxSizing="border-box",r.style.background=e.style.bgColor,r.style.position="absolute",r.style.top=0,r.style.left=0,r.style.zIndex=-1,r.className="text-item",l.a.document.body.appendChild(r),o(r).then((function(e){r.remove();var o=e.toDataURL();"function"==typeof t&&t(o)}))}catch(e){"function"==typeof t&&t("")}}))},e.prototype.share=function(e,t,o){s.a.isDemo()||(o&&(t.numOfItems=o),this.shareImp(e,t))},e.prototype.downloadTextItem=function(e){this.html2img(e,(function(e){try{e=e.replace(/^data:image\/[^;]/,"data:application/octet-stream"),l.a.open(e)}catch(e){}}))},e.prototype.getReachLevel=function(e){var t,o=Number(e||0);if(i.a.isUndefined(this.reachLevel)){var r=s.a.getLocalStorage();t=Number(r["".concat(this.siteUrl,"|reach-level")]||0)+o}else t=this.reachLevel+o;return t},e.prototype.setReachLevel=function(e){e>0||(e=0);try{var t=this.getReachLevel(0);if(e>0&&0===t&&i.a.isUndefined(this.reachLevel))s.a.getLocalStorage()["".concat(this.siteUrl,"|reach-level")]=e,this.reachLevel=e}catch(e){console.warn("set reach level error",e)}},e.prototype.getShareUrl=function(e){var t=this.shouldUseGalleryIdForShareUrl?this.galleryId+"_":this.compId.replace("comp-","")+"-";return this.pageUrl+"?pgid="+t+this.getItemId(e)},e.prototype.getItemId=function(e){return e.id||e.photoId||e.itemId},e.prototype.shareImp=function(e,t,o){var r={id:this.getItemId(t),idx:t.idx||0,url:t.createUrl&&t.createUrl("sample","img"),title:t.title||t.description||this.siteInfo.siteTitle,hashtag:t.hashtag},n=encodeURIComponent(this.getShareUrl(r)),a=encodeURIComponent(r.title||""),c=encodeURIComponent(r.url),p=encodeURIComponent(this.siteInfo.siteKeywords),h=encodeURIComponent("".concat(this.getShareUrl(r)));switch(i.a.isFunction(o)||(o=function(e,t){try{if(s.a.isiOS()&&"Email"===t)l.a.location.href=e;else{var o=l.a.open(e,t+" Share","height=640,width=960,toolbar=no,menubar=no,scrollbars=no,location=no,status=no");setTimeout((function(){try{"Email"===t&&o.location.hasOwnProperty("pathname")&&"blank"===o.location.pathname&&o.close()}catch(e){console.warn("Could not close mailto window")}}),5e3)}}catch(e){}}),e){case"facebook":o("http://www.facebook.com/sharer/sharer.php?u="+n+"&t="+a,"Facebook");break;case"twitter":var u="&amp;text="+("undefined"===a?"":a);if(u.length>110)u=u.slice(0,107)+"...";else{var d="&amp;hashtags="+p;(u+d).length<=110&&(u+=d)}o("https://twitter.com/intent/tweet?url="+n+u,"Twitter");break;case"pinterest":o("https://pinterest.com/pin/create/button/?url="+n+"&media="+c.replace("webp","jpg")+"&description="+a,"Pinterest");break;case"google":o("https://plus.google.com/share?url="+n,"Google Plus");break;case"tumblr":o("http://www.tumblr.com/share/link?url="+n,"Tumblr");break;case"email":o("mailto:?Subject="+a+"&body="+h,"Email");break;case"copylink":!function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t);var o=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.body.removeChild(t),o&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(o))}(this.getShareUrl(r))}},e.prototype.reportLoveToStats=function(e,t){try{if(!this.statsProps||!this.statsProps.instance_id)return void this.getStats();var o=i.a.merge(this.statsProps,{photo_id:e}),r=this.statsToken||l.a.statsToken,n=s.a.generateUUID();fetch(l.a.location.protocol+"//photographers-counters.wix.com/collector/rest/collect-js?ctToken="+r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageId:n,metrics:[{type:"photo",reportMetrics:[{name:"love",value:String(t)}],properties:o}]})}).then((function(e){console.log("Success report love",e)}))}catch(e){console.error("Error reporting love to stats",e)}},e.prototype.getLoveStorageKey=function(e){return"pro-gallery-item-love-"+e},e.prototype.isLoved=function(e){if(p.b.shouldUseReactionService()){var t=p.b.isLovedByCurrentVisitor(e,this.visitorId,this.reactionsServiceResponse),o=s.a.getLocalStorage()[this.getLoveStorageKey(e)];return t||o}try{return void 0!==s.a.getLocalStorage()&&(!!s.a.getLocalStorage()[this.getLoveStorageKey(e)]||!1)}catch(e){console.warn("isLoved failed",e)}},e.prototype.toggleLove=function(e,t){try{var o=this.isLoved(e)?"DELETE":"PUT";p.b.toggleItemLove(e,o,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId)}catch(t){if(s.a.isVerbose()&&console.warn("Reaction service toggleLove failed",t),"function"==typeof this.sentryReport){var r="Reaction Service error - couldn't toggle love data in gallery: ".concat(this.galleryId," item: ").concat(e);this.sentryReport(r)}}try{if(!s.a.getLocalStorage())return!1;var n=void 0;this.isLoved(e)&&!0!==t||!1===t?(s.a.getLocalStorage()[this.getLoveStorageKey(e)]="",n=-1):(s.a.getLocalStorage()[this.getLoveStorageKey(e)]=!0,n=1),this.reportLoveToStats(e,n)}catch(e){console.warn("toggleLove failed",e)}},e.prototype.isFirstLoveClick=function(e){try{return void 0===s.a.getLocalStorage()[this.getLoveStorageKey(e)]}catch(e){console.warn("isFirstLoveClick failed",e)}},e.prototype.postLoveActivity=function(e){var t=this.getItemId(e);this.isFirstLoveClick(t)&&function(e){try{var t={type:a.a.Activities.Type.SOCIAL_TRACK,info:{type:e.activityType,channel:e.activityNetwork,itemInfo:{itemUrl:e.url,itemId:e.id,itemType:e.type.toUpperCase()}},details:{additionalInfoUrl:e.url,summary:""},contactUpdate:null};a.a.Activities.postActivity(t,(function(e){console.log("Activity ID: "+e.activityId+", Contact ID: "+e.contactId)}),(function(e){console.log("Failure message:",e)}))}catch(e){console.log("error posting activity.",e)}}({activityType:"LOVE",activityNetwork:"SITE",id:t,url:this.getShareUrl(e),type:e.type})},e.prototype.showTooltip=function(e,t,o){if(!(document.getElementsByClassName("pro-tooltip").length>=1)){var r=e.currentTarget;if(r){var n,i,s=r.getBoundingClientRect(),a=s.top,p=s.left;try{i=l.a.innerWidth}catch(e){i=980}switch(void 0===o&&(o=p>i/2?"right":"left"),o){case"top":n={top:a-30+"px",left:p+28+"px",opacity:1};break;case"right":n={top:a-4+"px",left:p-20+"px",opacity:1};break;default:case"left":n={top:a-4+"px",left:p+40+"px",opacity:1}}n["pointer-events"]="none";var h=l.a.document.createElement("div");h.classList.add("pro-tooltip"),h.classList.add(o),Object.assign(h.style,n),h.innerHTML=c.a.getByKey(t),l.a.document.body.appendChild(h)}}},e.prototype.hideTooltip=function(){l.a.document.body.removeChild(document.getElementsByClassName("pro-tooltip")[0])},e.prototype.toggleTooltip=function(e,t,o){1===document.getElementsByClassName("pro-tooltip").length?this.hideTooltip():this.showTooltip(e,t,o)},e.prototype.viewClassName=function(e,t){return"fullscreen"===e&&"desktop"===t?"fullscreen-icon":""},e}();t.default=h;var u=new h},36:function(e,t,o){"use strict";o.d(t,"b",(function(){return p}));var r=o(0),n=o(23),i=o(8),s="love",a="love",c="loveCountFromStats",l=function(){function e(){this.getEncodedContextToken=this.getEncodedContextToken.bind(this),this.parseReactionServiceResponse=this.parseReactionServiceResponse.bind(this),this.newParseReactionServiceResponse=this.newParseReactionServiceResponse.bind(this)}return e.prototype.getItemsLoveData=function(e,t,o,n,s){return Object(r.b)(this,void 0,void 0,(function(){var a,c,l,p,h,u,d;return Object(r.d)(this,(function(r){switch(r.label){case 0:a=this.getEncodedContextToken(n,s),c=e.map((function(e){return e.itemId})),l=c.join("&resourceIds="),p="".concat(o,"/_api/reactions-server/v1/reactions?contextToken=").concat(a,"&resourceIds=").concat(l),r.label=1;case 1:return r.trys.push([1,6,,7]),[4,fetch(p,{method:"GET",headers:{"Content-Type":"application/json",Authorization:t}})];case 2:return 200!==(h=r.sent()).status?[3,4]:[4,h.json()];case 3:return u=r.sent().responses,void 0,[2,this.shouldUseNewParsing()?this.newParseReactionServiceResponse(u):this.parseReactionServiceResponse(u)];case 4:return i.a.isVerbose()&&console.error("Reaction-Service error - GET call response status: ".concat(h.status)),[2,{error:"Reaction-Service error - GET call response status: ".concat(h.status)}];case 5:return[3,7];case 6:return d=r.sent(),i.a.isVerbose()&&console.error("Reaction-Service error - some error when requesting data from reaction-service: ".concat(d.message)),[2,{error:"Reaction-Service error - some error when requesting data from reaction-service: ".concat(d.message)}];case 7:return[2]}}))}))},e.prototype.toggleItemLove=function(e,t,o,n,s,c){return Object(r.b)(this,void 0,void 0,(function(){var l,p,h,u,d,v;return Object(r.d)(this,(function(r){switch(r.label){case 0:l=this.getEncodedContextToken(s,c),p=a,h="".concat(n,"/_api/reactions-server/v1/reactions/").concat(e,"/").concat(p,"?contextToken=").concat(l),r.label=1;case 1:return r.trys.push([1,5,,6]),[4,fetch(h,{method:t,headers:{"Content-Type":"application/json",Authorization:o}})];case 2:return 200!==(u=r.sent()).status?[3,4]:[4,u.json()];case 3:d=r.sent(),i.a.isVerbose()&&console.log("Succeeded ".concat(t," action of Reactions service for item ").concat(e,". response: ").concat(d)),r.label=4;case 4:return[3,6];case 5:return v=r.sent(),i.a.isVerbose()&&console.error("Failed ".concat(t," action of Reactions service for item ").concat(e,". ").concat(v)),[2,{responses:"some error when requesting from reactions service"+h+v.message}];case 6:return[2]}}))}))},e.prototype.mergeDataFromStatsToReactionService=function(e,t,o,n,s,a){return Object(r.b)(this,void 0,void 0,(function(){var l,p,h,u,d,v;return Object(r.d)(this,(function(r){switch(r.label){case 0:l=this.getEncodedContextToken(s,a),p="".concat(n,"/_api/reactions-server/v1/reactions/").concat(e,"/add-reaction?contextToken=").concat(l),r.label=1;case 1:return r.trys.push([1,7,,8]),[4,fetch(p,{method:"POST",headers:{"Content-Type":"application/json",Authorization:o},body:JSON.stringify({reaction:{reactionCode:c,reactionParams:{count:String(t)}}})})];case 2:return 200!==(h=r.sent()).status?[3,4]:[4,h.json()];case 3:return u=r.sent(),i.a.isVerbose()&&console.log("Succeeded to POST old love counts from stats to Reactions service for item ".concat(e,". response: ").concat(u)),[2,{status:h.status,message:"success"}];case 4:return[4,h.json()];case 5:return d=r.sent().message,[2,{status:h.status,message:d}];case 6:return[3,8];case 7:return v=r.sent(),i.a.isVerbose()&&console.error("Failed to POST old love counts from stats to Reactions service for item ".concat(e,". ").concat(v)),[2,{responses:"some error when requesting from reactions service"+p+v.message}];case 8:return[2]}}))}))},e.prototype.isLovedByCurrentVisitor=function(e,t,o){var r,n;try{if(o){var i=null===(n=null===(r=o[e])||void 0===r?void 0:r.identityReactions)||void 0===n?void 0:n.reactions;return(null==i?void 0:i.findIndex((function(e){return e.identity.identityId===t&&e.reaction.reactionCode===a})))>-1}}catch(e){console.warn("isLovedByCurrentVisitor failed",e)}},e.prototype.parseReactionServiceResponse=function(e){var t;try{for(var o={},r=function(e,r){o[e]=0;var n=null===(t=r.identityReactions)||void 0===t?void 0:t.reactions,i=!1;n.forEach((function(t){var r,n,s;switch(null===(r=t.reaction)||void 0===r?void 0:r.reactionCode){case c:i||(o[e]+=Number(null===(s=null===(n=t.reaction)||void 0===n?void 0:n.reactionParams)||void 0===s?void 0:s.count),i=!0);break;case a:o[e]+=1}}))},n=0,s=Object.entries(e);n<s.length;n++){var l=s[n];r(l[0],l[1])}return o}catch(e){return i.a.isVerbose()&&console.error("Reaction-Service error - problem with parsing response: ".concat(e.message)),{error:"Reaction-Service error - problem with parsing response: ".concat(e.message)}}},e.prototype.newParseReactionServiceResponse=function(e){var t,o,r,n;try{for(var s={},l=0,p=Object.entries(e);l<p.length;l++){var h=p[l],u=h[0],d=h[1];s[u]=0;var v=null===(t=d.identityReactions)||void 0===t?void 0:t.reactions[0];if(v){switch(null===(o=v.reaction)||void 0===o?void 0:o.reactionCode){case c:s[u]+=Number(null===(n=null===(r=v.reaction)||void 0===r?void 0:r.reactionParams)||void 0===n?void 0:n.count);break;case a:default:s[u]+=1}s[u]+=Math.max(0,d.total-1)}else s[u]+=Math.max(0,d.total)}return s}catch(e){return i.a.isVerbose()&&console.error("Reaction-Service error - problem with new parsing response: ".concat(e.message)),{error:"Reaction-Service error - problem with new parsing response: ".concat(e.message)}}},e.prototype.shouldUseReactionService=function(){return!0},e.prototype.shouldUseNewParsing=function(){return n.b.getExperimentBoolean("specs.pro-gallery.useNewReactionsCalculation")||n.b.getExperimentBoolean("specs.pro-gallery.useNewReactionsCalculation-Rollout")},e.prototype.getEncodedContextToken=function(e,t){var o={authorizerAppDefId:t,contextId:e,contextType:s};return encodeURIComponent(JSON.stringify(o))},e.prototype.sampleMigrationSuccessRate=function(e,t,o){var r;try{if(Object.keys(e).length>0&&Object.keys(t).length>0){var n=Object.keys(e).length,i=(r=n,Math.floor(Math.random()*Math.floor(r))),s=Object.keys(e)[i],a=e[s],c=t.hasOwnProperty(s)&&t[s]||null;t.hasOwnProperty(s)?a<=c+2&&a>=c-2?"function"==typeof o&&o("Reaction-Service Migration 3rd try - Sample is successful"):"function"==typeof o&&o("Reaction-Service Migration 3rd try - Sample is failure"):"function"==typeof o&&o("Reaction-Service Migration 3rd try - Item doesnt exist in stats response")}else"function"==typeof o&&o("Reaction-Service Migration 3rd try - reactionService and stats responses are empty")}catch(e){"function"==typeof o&&o("Reaction-Service Migration 3rd try - Error in sampleMigrationSuccessRate")}},e}();t.a=l;var p=new l}}]);
//# sourceMappingURL=ItemActions.chunk.min.js.map